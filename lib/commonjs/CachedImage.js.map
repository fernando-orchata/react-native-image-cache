{"version":3,"sources":["CachedImage.tsx"],"names":["AnimatedImage","Animated","createAnimatedComponent","RNImage","AnimatedView","View","defaultProps","onError","CachedImage","props","error","setError","React","useState","uri","setUri","undefined","source","propsSource","animatedImage","useRef","Value","current","animatedThumbnailImage","animatedLoadingImage","load","catch","cacheKey","options","path","CacheManager","get","getPath","nativeEvent","Error","e","onThumbnailLoad","setTimeout","timing","toValue","useNativeDriver","start","duration","thumbnailAnimationDuration","config","onImageError","onImageLoad","sourceAnimationDuration","blurRadius","loadingImageComponent","LoadingImageComponent","loadingImageStyle","style","loadingSource","resizeMode","thumbnailSource","rest","isImageReady","styles","container","opacity","Platform","OS","imageStyle","StyleSheet","create","backgroundColor","bottom","left","position","right","top","alignItems","alignSelf","justifyContent"],"mappings":"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","sourcesContent":["import React, { useEffect } from 'react';\nimport {\n  Animated,\n  Image as RNImage,\n  Platform,\n  StyleSheet,\n  View,\n} from 'react-native';\n\nimport CacheManager from './CacheManager';\nimport { ImageProps, IProps } from './types';\n\nconst AnimatedImage = Animated.createAnimatedComponent(RNImage);\nconst AnimatedView = Animated.View;\n\nconst defaultProps = {\n  onError: () => {},\n};\n\nconst CachedImage = (props: IProps & typeof defaultProps) => {\n  const [error, setError] = React.useState<boolean>(false);\n  const [uri, setUri] = React.useState<string | undefined>(undefined);\n\n  const { source: propsSource } = props;\n\n  const animatedImage = React.useRef(new Animated.Value(0)).current;\n\n  const animatedThumbnailImage = React.useRef(new Animated.Value(0)).current;\n\n  const animatedLoadingImage = React.useRef(new Animated.Value(1)).current;\n\n  useEffect(() => {\n    if (propsSource !== uri) {\n      setUri(undefined);\n      load(props).catch();\n    }\n    /* eslint-disable react-hooks/exhaustive-deps */\n  }, [propsSource, uri]);\n\n  const load = async ({\n    cacheKey,\n    onError,\n    options = {},\n    source,\n  }: ImageProps): Promise<void> => {\n    if (source) {\n      try {\n        const path = await CacheManager.get(\n          source,\n          options,\n          cacheKey || source\n        ).getPath();\n        if (path) {\n          setUri(path);\n          setError(false);\n        } else {\n          setError(true);\n          onError({\n            nativeEvent: { error: new Error('Could not load image') },\n          });\n        }\n      } catch (e) {\n        setError(true);\n        onError({ nativeEvent: { error: e } });\n      }\n    }\n  };\n\n  const onThumbnailLoad = () => {\n    setTimeout(() => {\n      Animated.timing(animatedLoadingImage, {\n        toValue: 0,\n        useNativeDriver: true,\n      }).start(() => {\n        Animated.timing(animatedThumbnailImage, {\n          toValue: 1,\n          duration:\n            props.thumbnailAnimationDuration ||\n            CacheManager.config.thumbnailAnimationDuration,\n          useNativeDriver: true,\n        }).start();\n      });\n    }, 5000);\n  };\n\n  const onImageError = (): void => setError(true);\n\n  const onImageLoad = (): void => {\n    Animated.timing(animatedImage, {\n      toValue: 1,\n      duration:\n        props.sourceAnimationDuration ||\n        CacheManager.config.sourceAnimationDuration,\n      useNativeDriver: true,\n    }).start();\n  };\n\n  const {\n    blurRadius,\n    loadingImageComponent: LoadingImageComponent,\n    loadingImageStyle = props.style,\n    loadingSource,\n    resizeMode,\n    style,\n    thumbnailSource,\n    ...rest\n  } = props;\n\n  const isImageReady = !!uri;\n\n  return (\n    <View style={styles.container}>\n      {!isImageReady &&\n        (LoadingImageComponent ? (\n          <AnimatedView\n            style={[\n              styles.loadingImageStyle,\n              { opacity: animatedLoadingImage },\n            ]}\n          >\n            <LoadingImageComponent />\n          </AnimatedView>\n        ) : (\n          <View style={[styles.loadingImageStyle, style]}>\n            <AnimatedImage\n              resizeMode={resizeMode || 'contain'}\n              style={[{ opacity: animatedLoadingImage }, loadingImageStyle]}\n              // @ts-ignore\n              source={loadingSource}\n            />\n          </View>\n        ))}\n      <AnimatedImage\n        blurRadius={blurRadius || CacheManager.config.blurRadius}\n        onLoad={onThumbnailLoad}\n        resizeMode={resizeMode || 'contain'}\n        source={{ uri: thumbnailSource }}\n        style={[{ opacity: animatedThumbnailImage }, style]}\n      />\n      <AnimatedImage\n        {...rest}\n        onError={onImageError}\n        onLoad={onImageLoad}\n        resizeMode={resizeMode || 'contain'}\n        // @ts-ignore\n        source={\n          error || !uri\n            ? loadingSource\n            : {\n                uri: Platform.OS === 'android' ? `file://${uri}` : uri,\n              }\n        }\n        // @ts-ignore\n        style={[styles.imageStyle, { opacity: animatedImage }, style]}\n      />\n    </View>\n  );\n};\n\nconst styles = StyleSheet.create({\n  container: {\n    backgroundColor: 'transparent',\n  },\n  imageStyle: {\n    bottom: 0,\n    left: 0,\n    position: 'absolute',\n    right: 0,\n    top: 0,\n  },\n  loadingImageStyle: {\n    alignItems: 'center',\n    alignSelf: 'center',\n    bottom: 0,\n    justifyContent: 'center',\n    left: 0,\n    position: 'absolute',\n    right: 0,\n    top: 0,\n  },\n});\n\nCachedImage.defaultProps = defaultProps;\n\nexport default CachedImage;\n"]}